rule rawdisk_x86
{
	meta:
		Description = "Driver creation function for ElDos RawDisk wiper"
		Author = "Joe Slowik, Dragos Inc."
		sha256 = "4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6"
	strings:
		$a = { 8B FF 55 8B EC 83 EC 18 53 56 8B ?? ?? ?? 01 00 57 68 ?? ?? ?? 00 8D 45 ?? 50 FF D6 8B ?? ?? 68 ?? ?? ?? 00 6A 00 68 00 01 00 00 6A 22 8D 45 ?? 50 6A 00 57 FF ?? ?? ?? 01 00 8B D8 85 DB 7C ?? A1 ?? ?? ?? 00 83 60 1C EB 68 ?? ?? ?? 00 8D ?? ?? 50 FF D6 8B 1D ?? ?? ?? 00 8D ?? ?? 50 8D ?? ?? 50 FF D3 85 C0 7D }
	condition:
		uint16(0) == 0x5a4d and all of them
}

rule rawdisk_strings
{
	meta:
		Description = "Strings associated with ElDos RawDisk"
		Author = "Joe Slowik, Dragos Inc."
		sha256 = "4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6"
		sha256 = "5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a"
	strings:
		$s1 = "ElRawDisk" wide ascii
		$s2 = "ntoskrnl.exe" nocase wide ascii fullword
		$s3 = "\\Device\\ElRawDisk" wide ascii fullword
		$s4 = "EldoS " wide ascii
		$s5 = "RawDisk Driver" wide ascii
		$s6 = "HAL.dll" nocase ascii wide fullword
		$s7 = "RSDS" ascii wide fullword
		$s8 = "elrawdsk.pdb" nocase ascii wide
		$s9 = "info@eldos.com" nocase ascii wide
	condition:
		uint16(0) == 0x5a4d and 6 of ($s*)
}

rule rawdisk_x64
{
	meta:
		Description = "Driver creation function for ElDos RawDisk x64 version."
		Author = "Joe Slowik, Dragos Inc."
		sha256 = "5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a"
	strings:
		$a = { 48 83 EC 38 48 ?? ?? ?? ?? 00 00 48 ?? ?? ?? 20 FF ?? ?? ?? ?? FF 48 ?? ?? ?? 20 FF ?? ?? ?? FF FF 48 8B ?? ?? ?? FF FF FF ?? ?? ?? FF FF 48 ?? ?? ?? ?? FF FF 00 48 83 C4 38 C3 }
		$b = { 48 89 5C 24 08 57 48 83 EC 70 48 8B D9 48 ?? ?? ?? ?? 00 00 48 ?? ?? ?? 40 FF ?? ?? ?? FF FF 48 8D ?? ?? ?? FF FF 4C 8D ?? ?? ?? 48 ?? ?? ?? ?? 41 B9 22 00 00 00 48 8B CB 33 D2 C6 ?? ?? ?? 00 C7 ?? ?? ?? 00 01 00 00 FF ?? ?? ?? FF FF 85 C0 8B F8 78 5F 48 ?? ?? ?? ?? FF FF 48 8D ?? ?? ?? 00 00 48 8D ?? ?? ?? 83 60 30 EB FF ?? ?? ?? FF FF 48 8D ?? ?? ?? 48 8D ?? ?? ?? FF ?? ?? ?? FF FF 85 C0 79 }
	condition:
		uint16(0) == 0x5a4d and all of them
}
